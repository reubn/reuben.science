<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><link rel="apple-touch-icon" sizes="57x57" href="/favicon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon-180x180.png"/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png"/><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><meta name="msapplication-TileImage" content="/favicon-144x144.png"/><meta name="msapplication-config" content="/browserconfig.xml"/><meta name="theme-color" content="#0E151B"/><link rel="alternate" type="application/rss+xml" href="https://reuben.science/rss.xml"/><noscript><style>[data-noscript="no"]{display: none!important}</style></noscript><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@_reubn"/><meta name="twitter:creator" content="@_reubn"/><meta property="og:locale" content="en_GB"/><title>Wakeup Lights with Shortcuts | Reuben</title><meta name="robots" content="index,follow"/><meta name="description" content="Sunrise Lights using Shortcuts, and Home Assistant"/><meta property="og:title" content="Wakeup Lights with Shortcuts"/><meta property="og:description" content="Sunrise Lights using Shortcuts, and Home Assistant"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023-08-07T00:00:00.000Z"/><meta property="article:author" content="Reuben"/><meta property="article:tag" content="dev"/><meta property="article:tag" content="automation"/><meta property="og:image" content="https://reuben.science/.assets/afcc8d383d981938c46d0641e9035280/header.webp"/><meta property="og:image:alt" content="Wakeup Lights with Shortcuts"/><meta property="og:image:width" content="1000"/><meta property="og:image:height" content="400"/><meta property="og:site_name" content="reuben.science"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://reuben.science/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://reuben.science/posts","name":"Posts"}},{"@type":"ListItem","position":3,"item":{"@id":"https://reuben.science/posts/shortcuts-wakeup-alarm","name":"Wakeup Lights with Shortcuts"}}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","datePublished":"2023-08-07T00:00:00.000Z","description":"Sunrise Lights using Shortcuts, and Home Assistant","mainEntityOfPage":{"@type":"WebPage"},"headline":"Wakeup Lights with Shortcuts","dateModified":"2023-08-07T00:00:00.000Z","author":[{"@type":"Person","name":"Reuben"}],"publisher":{"@type":"Organization","name":"Reuben"}}</script><meta name="next-head-count" content="44"/><link rel="preload" href="/_next/static/css/16ee933f901701c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/16ee933f901701c7.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ed36f851a8b08b30.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ed36f851a8b08b30.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-4d76bee852fed354.js" defer=""></script><script src="/_next/static/chunks/framework-3583eef75b58b7b2.js" defer=""></script><script src="/_next/static/chunks/main-e941308dff44c5fa.js" defer=""></script><script src="/_next/static/chunks/pages/_app-dbf6d3b989bc8957.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-3ba9fceac609e593.js" defer=""></script><script src="/_next/static/0X5amzdhl_xuQnsesc_MO/_buildManifest.js" defer=""></script><script src="/_next/static/0X5amzdhl_xuQnsesc_MO/_ssgManifest.js" defer=""></script></head><body><div id="__next"><section class="_app_app__jrTHQ _app_loadGlitchFix__EV67e"><header class="styles_header__bd3ZT"><svg role="banner" class="styles_logo__OPbWM  styles_svg__qyW1z" viewBox="0 0 994 994"><defs><linearGradient x1="0%" y1="0%" x2="99.9884439%" y2="99.9884439%" id="orange"><stop stop-color="hsl(14, 100%, 61%)" offset="0.0115561319%"></stop><stop stop-color="hsl(32, 97%, 57%)" offset="100%"></stop></linearGradient><linearGradient x1="100%" y1="100%" x2="0%" y2="0%" id="yellow"><stop stop-color="hsl(56, 97%, 57%)" offset="0%"></stop><stop stop-color="hsl(51, 100%, 61%)" offset="100%"></stop></linearGradient><linearGradient x1="8.8817842e-14%" y1="8.8817842e-14%" x2="100%" y2="100%" id="red"><stop stop-color="hsl(0, 100%, 66%)" offset="0%"></stop><stop stop-color="hsl(0, 97%, 57%)" offset="100%"></stop></linearGradient><linearGradient x1="0%" y1="0%" x2="100%" y2="100%" id="blue"><stop stop-color="hsl(180, 90%, 48%)" offset="0%"></stop><stop stop-color="hsl(201, 97%, 50%)" offset="100%"></stop></linearGradient><linearGradient x1="0%" y1="-1.77635684e-13%" x2="100%" y2="100%" id="purple"><stop stop-color="hsl(244, 100%, 66%)" offset="0%"></stop><stop stop-color="hsl(274, 97%, 57%)" offset="100%"></stop></linearGradient><linearGradient x1="100%" y1="100%" x2="-7.10542736e-13%" y2="7.10542736e-13%" id="green"><stop stop-color="hsl(117, 100%, 66%)" offset="0%"></stop><stop stop-color="hsl(158, 97%, 57%)" offset="100%"></stop></linearGradient></defs><g><g transform="translate(-565.000000, -233.000000)"><g transform="translate(1062.000000, 730.000000) rotate(-45.000000) translate(-1062.000000, -730.000000) translate(712.000000, 378.000000)"><path d="M400,20.0660172 L400,230.066017 C400,241.111712 391.045695,250.066017 380,250.066017 L270,250.066017 C258.954305,250.066017 250,259.020322 250,270.066017 L250,280.066017 C250,291.111712 258.954305,300.066017 270,300.066017 L680,300.066017 C691.045695,300.066017 700,309.020322 700,320.066017 L700,680.066017 C700,691.111712 691.045695,700.066017 680,700.066017 L320,700.066017 C308.954305,700.066017 300,691.111712 300,680.066017 L300,620.066017 C300,609.020322 308.954305,600.066017 320,600.066017 L580,600.066017 C591.045695,600.066017 600,591.111712 600,580.066017 L600,570.066017 C600,559.020322 591.045695,550.066017 580,550.066017 L320,550.066017 C308.954305,550.066017 300,541.111712 300,530.066017 L300,470.066017 C300,459.020322 308.954305,450.066017 320,450.066017 L580,450.066017 C591.045695,450.066017 600,441.111712 600,430.066017 L600,420.066017 C600,409.020322 591.045695,400.066017 580,400.066017 L170,400.066017 C158.954305,400.066017 150,391.111712 150,380.066017 L150,170.066017 C150,159.020322 158.954305,150.066017 170,150.066017 L280,150.066017 C291.045695,150.066017 300,141.111712 300,130.066017 L300,120.066017 C300,109.020322 291.045695,100.066017 280,100.066017 L120,100.066017 C108.954305,100.066017 100,109.020322 100,120.066017 L100,380.066017 C100,391.111712 91.045695,400.066017 80,400.066017 L20,400.066017 C8.954305,400.066017 1.3527075e-15,391.111712 0,380.066017 L0,20.0660172 C-1.3527075e-15,9.02032218 8.954305,0.066017178 20,0.066017178 L380,0.066017178 C391.045695,0.066017178 400,9.02032218 400,20.0660172 Z" class="styles_type__1rWKD styles_lodFlat__ofLbh"></path><g transform="translate(0.000000, 0.066017)"><g transform="translate(449.933983, 0.000000)"><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_t1__L_QSS styles_dim__UTcnE" x="0.066017178" y="0" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_t2__ryFqt styles_dim__UTcnE" x="2.84217094e-14" y="149.93" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_t3__LXXuQ styles_dim__UTcnE" x="150" y="149.93" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_t1__L_QSS undefined styles_interactive__0vH_3 " x="0.066017178" y="0" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_t2__ryFqt undefined styles_interactive__0vH_3 " x="2.84217094e-14" y="149.93" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_t3__LXXuQ undefined styles_interactive__0vH_3 " x="150" y="149.93" rx="20px"></rect></g><g transform="translate(0.000000, 452.933983)"><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_b1__Xrrmn styles_dim__UTcnE" x="5.68434189e-14" y="0.066017178" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_b2__iImSA styles_dim__UTcnE" x="150.066017" y="1.13686838e-13" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodFlat__ofLbh styles_b3__tHvPP styles_dim__UTcnE" x="149.933983" y="149.996017" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_b1__Xrrmn undefined styles_interactive__0vH_3 " x="5.68434189e-14" y="0.066017178" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_b2__iImSA undefined styles_interactive__0vH_3 " x="150.066017" y="1.13686838e-13" rx="20px"></rect><rect class="styles_square__SJD5V styles_lodRainbowGradient__3y0nV styles_b3__tHvPP undefined styles_interactive__0vH_3 " x="149.933983" y="149.996017" rx="20px"></rect></g></g></g></g></g></svg><nav class="styles_nav__P985N"><a aria-hidden="true" tabindex="-1" class="styles_link__WDwlV  styles_secret__RCFAg false" style="--link-underline:linear-gradient(135deg, var(--colours-green) 0%, var(--colours-green-hint) 100%)" href="/nowhere"></a><a class="styles_link__WDwlV " style="--link-underline:linear-gradient(135deg, var(--colours-pink-red) 0%, var(--colours-pink-red-hint) 100%)" href="/">Home</a><a class="styles_link__WDwlV " style="--link-underline:linear-gradient(135deg, var(--colours-blue) 0%, var(--colours-blue-hint) 100%)" href="/posts">Posts</a><a class="styles_link__WDwlV " style="--link-underline:linear-gradient(135deg, var(--colours-indigo) 0%, var(--colours-indigo-hint) 100%)" href="/snippets">Snippets</a></nav></header><main class="_app_content__N_c_N"><article class="styles_post__sCWlT"><section class="styles_categories__o_jKp"><a class=" styles_category__7Q41R" style="--category-background:linear-gradient(135deg, var(--colours-blue) 0%, var(--colours-blue-hint) 100%)" href="/categories/dev">dev</a><a class=" styles_category__7Q41R" style="--category-background:linear-gradient(135deg, var(--colours-yellow) 0%, var(--colours-yellow-hint) 100%)" href="/categories/automation">automation</a></section><h1 class="styles_title__qipDA">Wakeup Lights with Shortcuts</h1><h2 class="styles_description__cO8v8">Sunrise Lights using Shortcuts, and Home Assistant</h2><img width="1000" height="400" src="/.assets/afcc8d383d981938c46d0641e9035280/header.webp" srcSet="/.assets/afcc8d383d981938c46d0641e9035280/header.webp 1000w, /.assets/63c382a6dfa9a50deac4c1350c6c2698/header.webp 2000w, /.assets/82ac3a5f077f7c29198c3d9be1b27ac1/header.webp 3000w, /.assets/9e46b0ed7a1cae2ac96070e91b37ed76/header.webp 500w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw styles_headerImage__MZEnR" style="aspect-ratio:1000/400" loading="lazy" alt="ðŸ’¡"/><span class="styles_info__nt0yU"><time dateTime="07/08/2023">07/08/2023</time><span class="styles_readingTime__q8kr0"><time time="PD0T0H8M" aria-label="Reading Time">8<!-- --> min<!-- -->s</time></span></span><div class="styles_body__FFHV7 false" id="HACK-POST-shortcuts-wakeup-alarm"><!--$-->
<!-- -->
<!-- -->
<p>I wake up better in the summer than the winter. I think this is due in large part to the abundance of natural light coming through the windows in the morning. In the winter, when the days are short and the nights long, waking up without this light is often inevitable.</p>
<p>I wanted to try and emulate this <em>natural</em> wakeup in the mornings all year round.</p>
<p>I have an extensive <a href="">Home Assistant</a> set up, so this wouldn&#x27;t initially seem very involved. My wakeup schedule changes frequently however, and I wanted a system that could easily change with this, whilst not relying on me to remember.</p>
<h1 id="bedtime"><a href="#bedtime">Bedtime</a></h1>
<p>I already use the <a href="https://support.apple.com/en-gb/HT208655">Bedtime</a> scheduling and alarms on my iPhone, so in this post I&#x27;ll discuss how I bridged the gap between Home Assistant and iOS Bedtime system.</p>
<p>Bedtime on iOS is a mess. It consists of 3 main aspects:</p>
<ul>
<li>a Focus Mode that dims the display when locked and hides notifications etc.</li>
<li>the wakeup alarms</li>
<li>a sleep schedule with reminders to &#x27;wind down&#x27;, that automatically activates the Focus Mode, and wakeup alarms</li>
</ul>
<p>There is no unified point of access or coordination for these features:
<strong>Wakeup alarms</strong> are visible and are managed in the <strong>Clock app</strong>, along with normal alarms. Wakeup alarms are set based on a <strong>sleep schedule</strong> that determines what days the alarm is active, and is managed in the <strong>Health app</strong>. The <strong>Focus Mode</strong> is managed through the <strong>Focus Mode settings</strong> and <strong>Control Centre</strong>.</p>
<p>From the schedule and its days and wakeup times, alarms appear in the <strong>Clock app</strong> under <strong>&#x27;Sleep | Wake Up&#x27;</strong>.</p>
<p>When editing a wakeup alarm, you can opt to change the next alarm, or the whole schedule.</p>
<h1 id="what-are-we-trying-to-build"><a href="#what-are-we-trying-to-build">What are we trying to build?</a></h1>
<p>In short, the flow of the system should be:</p>
<ol>
<li>Detect the next wakeup alarm time</li>
<li><code>30min</code> before this alarm goes off, start fading the bedroom lights up</li>
</ol>
<p>While simple in principle, there are plenty of complications that make this somewhat awkward to achieve. And so there&#x27;s a fair few steps that we&#x27;ll have to work through to achieve this.</p>
<h1 id="adventures-in-the-walled-garden"><a href="#adventures-in-the-walled-garden">Adventures in the Walled Garden</a></h1>
<p>The first step of this process is to get the details of the active Bedtime wakeup alarm. Being in Apple&#x27;s closed-off ecosystem this is not easy. There is no system API to access the information. The only place that this is accessible is via the <strong>Shortcuts app</strong>.</p>
<p>The Shortcuts app is the newer, prettier, less capable evolution of macOS&#x27; Automator. It&#x27;s slow, unpredictable, lacking in capability and incredible esoteric. As we&#x27;ll come to see, it&#x27;s also very buggy. It it does work, it&#x27;s just frustrating that with some love and attention it could be <strong>so much</strong> better!</p>
<p>Shortcuts allows us to get most of the details for the alarms. However, the alarms displayed in the Clock app do not always match what can be queried from Shortcuts.</p>
<p>For example, modifying the next occurrence of an alarm will result in 2 alarms:</p>
<ul>
<li>the original scheduled alarm</li>
<li>another alarm to represent the modified occurrence</li>
</ul>
<p>Only 1 alarm is shown in the app. This is understandable. What isn&#x27;t is that <strong>we are not told which alarms are enabled or disabled</strong>: so if the user skips tomorrows alarm, we don&#x27;t know this.</p>
<p>In most circumstances we can however infer the status of the alarm. The interactions that are possible with a Bedtime alarm, and the resulting alarms we&#x27;ll receive in our Shortcut are as followed:</p>
<!-- -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1438 1552" style="width:100%"><defs><text id="b" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="274.963" y="375.258">TURN OFF ALARM</tspan></text><text id="d" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="263.346" y="142">CHANGE SCHEDULE</tspan></text><text id="f" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="224.578" y="592">CHANGE NEXT ALARM TIME</tspan></text><text id="h" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="245.011" y="816.808">TURN OFF NEXT ALARM</tspan></text><text id="j" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="161.31" y="1044.85">CHANGE TIME &amp; TURN OFF NEXT ALARM</tspan></text><text id="l" fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="2"><tspan x="148.997" y="3">NO CHANGES</tspan></text></defs><g fill="none" fill-rule="evenodd"><path fill="var(--colours-light)" d="m825.499 718.695-10 5.769a1 1 0 0 1-1.499-.867V712.06a1 1 0 0 1 1.5-.866l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M227 334v359.293c0 13.255 10.745 24 24 24h563"></path><g fill="var(--colours-light)" transform="translate(227 334)"><use href="#b" filter="url(#a)"></use><use href="#b"></use></g><path fill="var(--colours-aqua)" d="M867.383 659h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 689.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 697.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 682)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 682)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-aqua)" d="M919.256 644h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(909 644)"><tspan x="6.43" y="21">DISABLED</tspan></text><path fill="var(--colours-light)" d="m825.499 485.366-10 5.769a1 1 0 0 1-1.499-.866V478.73a1 1 0 0 1 1.5-.866l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M227 334v126c0 13.255 10.745 24 24 24h563"></path><g fill="var(--colours-light)" transform="translate(227 334)"><use href="#d" filter="url(#c)"></use><use href="#d"></use></g><path fill="var(--colours-aqua)" d="M867.383 434h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 464.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 472.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 457)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 457)"><tspan x="29.301" y="56">06:30 MTWTF</tspan></text><path fill="var(--colours-aqua)" d="M919.256 419h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(909 419)"><tspan x="9.826" y="21">ENABLED</tspan></text><path fill="var(--colours-light)" d="m825.499 935.366-10 5.769a1 1 0 0 1-1.499-.866V928.73a1 1 0 0 1 1.5-.866l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M227 334v576c0 13.255 10.745 24 24 24h563"></path><g fill="var(--colours-light)" transform="translate(227 334)"><use href="#f" filter="url(#e)"></use><use href="#f"></use></g><path fill="var(--colours-aqua)" d="M867.383 884h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 914.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 922.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 907)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 907)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-aqua)" d="M919.256 869h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(909 869)"><tspan x="6.704" y="21">OFF 10/01</tspan></text><path fill="var(--colours-blue)" d="M1117.383 884h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603h-194.234c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M1119.439 914.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 1118 922.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97h-4.913Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(1118 907)"><tspan x="35.55" y="23">Fixed Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1118 907)"><tspan x="22.309" y="56">06:30 10/01/23</tspan></text><path fill="var(--colours-blue)" d="M1169.256 869h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1159 869)"><tspan x="9.826" y="21">ENABLED</tspan></text><path fill="var(--colours-light)" d="m825.499 1160.192-10 5.769a1 1 0 0 1-1.499-.866v-11.537a1 1 0 0 1 1.5-.867l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M227 334v800.817c0 13.255 10.745 24 24 24h563"></path><g fill="var(--colours-light)" transform="translate(227 334)"><use href="#h" filter="url(#g)"></use><use href="#h"></use></g><path fill="var(--colours-aqua)" d="M867.383 1109h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 1139.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 1147.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 1132)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 1132)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-aqua)" d="M919.256 1094h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(909 1094)"><tspan x="6.704" y="21">OFF 10/01</tspan></text><path fill="var(--colours-blue)" d="M1117.383 1109h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603h-194.234c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M1119.439 1139.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209 11.318 11.318 0 0 0-11.324 11.324c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97h-4.913Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(1118 1132)"><tspan x="35.55" y="23">Fixed Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1118 1132)"><tspan x="22.032" y="56">06:00 10/01/23</tspan></text><path fill="var(--colours-blue)" d="M1169.256 1094h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1159 1094)"><tspan x="6.43" y="21">DISABLED</tspan></text><path fill="var(--colours-light)" d="m825.499 1388.23-10 5.769a1 1 0 0 1-1.499-.866v-11.538a1 1 0 0 1 1.5-.866l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M227 334v1028.857c0 13.255 10.745 24 24 24h563"></path><g fill="var(--colours-light)" transform="translate(227 334)"><use href="#j" filter="url(#i)"></use><use href="#j"></use></g><path fill="var(--colours-aqua)" d="M867.383 1336h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 1366.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 1374.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 1359)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 1359)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-aqua)" d="M919.256 1321h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(909 1321)"><tspan x="6.704" y="21">OFF 10/01</tspan></text><path fill="var(--colours-blue)" d="M1117.383 1336h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603h-194.234c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M1119.439 1366.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209 11.318 11.318 0 0 0-11.324 11.324c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97h-4.913Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(1118 1359)"><tspan x="35.55" y="23">Fixed Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1118 1359)"><tspan x="22.309" y="56">06:30 10/01/23</tspan></text><path fill="var(--colours-blue)" d="M1169.256 1321h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(1159 1321)"><tspan x="6.43" y="21">DISABLED</tspan></text><path fill="var(--colours-aqua)" d="M867.383 209h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H867.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><path fill="var(--colours-light)" fill-rule="nonzero" d="M869.439 239.147c.187 0 .304-.046.491-.175l4.27-3.077a.667.667 0 0 0 .304-.538c0-.269-.128-.503-.35-.678-.527-.445-1.334-.679-2.13-.679-1.93 0-3.498 1.51-3.498 3.404 0 .503.082.948.223 1.252.128.292.386.491.69.491Zm19.77 0c.305 0 .55-.199.69-.491.141-.292.211-.749.211-1.252 0-1.895-1.556-3.404-3.498-3.404-.783 0-1.59.234-2.129.679-.222.175-.35.409-.35.678 0 .199.116.398.315.538l4.27 3.077c.176.129.304.175.491.175Zm-19.84 19.537c.433.433 1.123.421 1.567-.035l1.919-1.907a11.29 11.29 0 0 0 6.47 2.024c2.397 0 4.632-.749 6.468-2.024l1.919 1.907c.445.444 1.135.468 1.568.035a1.063 1.063 0 0 0-.012-1.52l-1.825-1.826a11.318 11.318 0 0 0-8.119-19.209A11.318 11.318 0 0 0 868 247.453c0 3.065 1.217 5.85 3.205 7.885l-1.836 1.825a1.063 1.063 0 0 0 0 1.52Zm5.03-9.686a.964.964 0 0 1-.983-.971c0-.55.433-.971.983-.971h3.943v-5.65c0-.55.432-.972.97-.972.55 0 .983.421.983.971v6.622c0 .55-.433.97-.983.97H874.4Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(868 232)"><tspan x="35.55" y="23">Repeat Alarm</tspan></text><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(868 232)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-aqua)" d="M920.256 194h89.488c3.567 0 4.86.371 6.163 1.069a7.27 7.27 0 0 1 3.024 3.024c.698 1.303 1.069 2.596 1.069 6.163v19.488c0 3.567-.371 4.86-1.069 6.163a7.27 7.27 0 0 1-3.024 3.024c-1.303.698-2.596 1.069-6.163 1.069h-89.488c-3.567 0-4.86-.371-6.163-1.069a7.27 7.27 0 0 1-3.024-3.024c-.698-1.303-1.069-2.596-1.069-6.163v-19.488c0-3.567.371-4.86 1.069-6.163a7.27 7.27 0 0 1 3.024-3.024c1.303-.698 2.596-1.069 6.163-1.069Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(910 194)"><tspan x="9.826" y="21">ENABLED</tspan></text><path stroke="var(--colours-light)" stroke-linecap="square" stroke-width="3" d="M374 259.5h447"></path><path fill="var(--colours-light)" d="m825.499 260.366-10 5.769a1 1 0 0 1-1.499-.866V253.73a1 1 0 0 1 1.5-.866l9.999 5.769a1 1 0 0 1 0 1.732Z"></path><g fill="var(--colours-light)" transform="translate(374 249)"><use href="#l" filter="url(#k)"></use><use href="#l"></use></g><path fill="var(--colours-orange)" d="M139.383 209h194.234c5.349 0 7.289.557 9.244 1.603a10.904 10.904 0 0 1 4.536 4.536c1.046 1.955 1.603 3.895 1.603 9.244v69.234c0 5.349-.557 7.289-1.603 9.244a10.904 10.904 0 0 1-4.536 4.536c-1.955 1.046-3.895 1.603-9.244 1.603H139.383c-5.349 0-7.289-.557-9.244-1.603a10.904 10.904 0 0 1-4.536-4.536c-1.046-1.955-1.603-3.895-1.603-9.244v-69.234c0-5.349.557-7.289 1.603-9.244a10.904 10.904 0 0 1 4.536-4.536c1.955-1.046 3.895-1.603 9.244-1.603Z"></path><text fill="var(--colours-light)" font-size="18" font-weight="bold" letter-spacing="1.5" transform="translate(139 232)"><tspan x="16.16" y="56">06:00 MTWTFSS</tspan></text><path fill="var(--colours-light)" fill-rule="nonzero" d="M145.4 243.587h2.536v-1.35c0-.933.515-1.439 1.467-1.439h3.595c.943 0 1.467.506 1.467 1.438v1.35h2.186v-1.35c0-.932.515-1.438 1.506-1.438h3.41c.992 0 1.517.506 1.517 1.438v1.35h2.536v-2.788c0-1.846-.992-2.798-2.799-2.798h-14.633c-1.797 0-2.788.952-2.788 2.798v2.789Zm-2.4 10.357c0 .525.34.855.855.855h.602c.515 0 .855-.33.855-.855v-1.399c.107.03.447.049.69.049h18.996c.243 0 .583-.02.7-.049v1.4c0 .524.34.854.854.854h.593c.525 0 .855-.33.855-.855v-5.897c0-1.924-1.06-2.974-3.002-2.974h-18.996c-1.943 0-3.002 1.05-3.002 2.974v5.897Z"></path><text fill="var(--colours-light)" font-size="24" font-weight="400" transform="translate(139 232)"><tspan x="35" y="23">Bedtime Alarm</tspan></text><text fill="var(--colours-light)" font-size="28" font-weight="400" letter-spacing="2.333"><tspan x="970.841" y="97">Alarms Received</tspan></text></g></svg>
<p>There can still be ambiguity between the returned alarms and the next alarm time.
We can&#x27;t solve this at present, so I&#x27;ve opted to work out the most likely next alarm time, prompt the user, and allow them to clarify, if the next alarm time is wrong.</p>
<!-- -->
<section style="display:flex"><img width="828" height="1792" src="/.assets/4da23d4ab942096987e440a199f0eb01/IMG_5562.webp" srcSet="/.assets/4da23d4ab942096987e440a199f0eb01/IMG_5562.webp 828w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw " style="max-width:50%" loading="lazy" alt="Confirming that Alarm will Run"/><img width="828" height="1792" src="/.assets/db036589bb21b6a71b14fc0cd328f67b/IMG_5560.webp" srcSet="/.assets/db036589bb21b6a71b14fc0cd328f67b/IMG_5560.webp 828w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw " style="max-width:50%" loading="lazy" alt="Selecting Active Alarm"/></section>
<!-- -->
<section style="display:flex"><img width="828" height="1792" src="/.assets/2cc44ce3bcfd6319caa0c3a52d78c44f/IMG_5561.webp" srcSet="/.assets/2cc44ce3bcfd6319caa0c3a52d78c44f/IMG_5561.webp 828w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw " style="max-width:50%" loading="lazy" alt="Selecting Alarm time"/><img width="828" height="1792" src="/.assets/b44a0dc2db54f80fe1dc01b5bfd31223/IMG_5559.webp" srcSet="/.assets/b44a0dc2db54f80fe1dc01b5bfd31223/IMG_5559.webp 828w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw " style="max-width:50%" loading="lazy" alt="Confirming that no Alarm will Run"/></section>
<p>The logic to implement this would be very difficult to achieve in Shortcuts alone. Our escape hatch is the ability to load a <code>HTML</code> page in our Shortcut, and  run arbitrary <strong>synchronous</strong> <code>JavaScript</code> to calculate the next alarm that will be enabled and the time it will go off at.</p>
<p>To assist in provide data to our script, handling errors, and getting values back out, I&#x27;ve written a helper Shortcut and small <code>JS</code> function.</p>
<pre><span><button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button></span><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">shortcutsRuntime</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">run<span class="token punctuation">,</span> _input<span class="token operator">=</span>input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">input</span><span class="token operator">:</span> _input<span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">run</span><span class="token punctuation">(</span>_input<span class="token punctuation">,</span> output<span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">error</span><span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token literal-property property">stack</span><span class="token operator">:</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">,</span> <span class="token operator">...</span>output<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// USAGE:</span>
<span class="token function">shortcutsRuntime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">.</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;a is empty&#x27;</span><span class="token punctuation">)</span>

  output<span class="token punctuation">.</span>returnValueA <span class="token operator">=</span> input<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">apple</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#x27;quince&#x27;</span><span class="token punctuation">)</span>
  output<span class="token punctuation">.</span>returnValueB <span class="token operator">=</span> input<span class="token punctuation">.</span>b<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">oyster</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#x27;mushroom&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">/*{a: &#x27;apples&#x27;, b: &#x27;scarlet elf cups&#x27;}*/</span><span class="token punctuation">)</span>

</code></pre>
<h1 id="scheduling-the-fade"><a href="#scheduling-the-fade">Scheduling the Fade</a></h1>
<p>Now that we have the next alarm time, we need to set the lights to start fading up <code>30min</code> before.</p>
<p>Shortcuts only proper method of delaying executing of code is the &#x27;Wait&#x27; action. This is limited to the life of the <code>Shortcut Runner</code> - which is often shut down in the background - making it unreliable. There are some hacks with Reminders[^reminders], but these also have caveats.</p>
<p>Home Assistant also doesn&#x27;t make scheduling one off events easy, so I&#x27;ve opted to run a small <code>Node.js</code> application that handles scheduling and performing the fading via the Home Assistant <a href="https://developers.home-assistant.io/docs/api/websocket">WebSocket API</a>.</p>
<p>The alarms are sent to the application, along with the desired wakeup time, and timers are set and persisted to a <code>SQLite</code> database for increased resilience if the application crashes. At the appropriate time the application starts to fade in the bedroom lights via the Home Assistant API.</p>
<h1 id="fading"><a href="#fading">Fading</a></h1>
<p>Home Assistant lights support fading via the <a href="https://www.home-assistant.io/integrations/light/#service-lightturn_on"><code>transition</code></a> attribute. It&#x27;s not very well documented, but this is only supported by certain lights. It&#x27;s also disadvantageous because (at least for my TP-Link Kasa <code>LB130</code>) lights become unresponsive until the fade is complete. You also don&#x27;t have any control over the easing/rate of change.</p>
<p>Because of this, I&#x27;ve implemented the fading in the <code>Node.js</code> application.</p>
<h2 id="easing"><a href="#easing">Easing</a></h2>
<p>By the time you&#x27;re awake the lights should be really bright, but at the same time, you don&#x27;t want the lights to wake you up too early during the transition.</p>
<p>I found that when I faded the lights linearly there were two main issues:</p>
<ul>
<li>whilst the fade was linear, it felt artificial and did not mimic sunrise</li>
<li>the initial lowest levels of brightness were impossible to achieve as my 2 lights working together effectively doubled the minimum <code>lux</code> experienced in the room.</li>
</ul>
<p>I solved these problems using 2 techniques.</p>
<p>Firstly, the lights are faded up using an easing function. There&#x27;s not much science here: I just played with BÃ©zier curves until it <em>felt</em> right, and until I was waking <code>&lt;10min</code> before the alarm rang.</p>
<!-- -->
<div style="width:100%" class=" styles_demo__tieiH styles_off__HEp6D"><h2>Easing Function Demo</h2><div class="styles_wrapper__q2w3Q"><div><div class="styles_progress__L8uHl"><span></span></div><div class="styles_progressLabels__59Cli"><span>0&#x27;</span><span>15&#x27;</span><span>30&#x27;</span></div></div><div class="styles_roomGroup__JeBkX"><div class="styles_room__abLxh styles_linearLight__Bdtdh"><div class="styles_lightGroup__6tSoE"><div class="styles_light__KQpD5"></div><div class="styles_light2__nS58D"></div></div><p>Linear</p></div><div class="styles_room__abLxh styles_bezierLight__nLuN4"><div class="styles_lightGroup__6tSoE"><div class="styles_light__KQpD5"></div><div class="styles_light2__nS58D"></div></div><p>BÃ©zier + Stagger</p></div></div></div></div>
<pre><span><button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button></span><code class="language-js"><span class="token keyword">import</span> BezierEasing <span class="token keyword">from</span> <span class="token string">&#x27;bezier-easing&#x27;</span>

<span class="token keyword">const</span> easing <span class="token operator">=</span> <span class="token function">BezierEasing</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">.82</span><span class="token punctuation">,</span> <span class="token number">.82</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> easedProgress <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">easing</span><span class="token punctuation">(</span>linearProgress<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment">// minimum brightness</span>
</code></pre>
<p>I also staggered the 2 lights, so that the 2<sup>nd</sup> light comes on <code>10%</code> of the way through the transition, fading at a faster rate to reach <code>100%</code> brightness at the same time as the first light.</p>
<pre><span><button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button></span><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">waitToFade</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">startAt<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> faded <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value <span class="token operator">-</span> startAt<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> startAt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> fn <span class="token operator">?</span> <span class="token function">fn</span><span class="token punctuation">(</span>faded<span class="token punctuation">)</span> <span class="token operator">:</span> faded
<span class="token punctuation">}</span>

<span class="token comment">// USAGE</span>
<span class="token keyword">const</span> secondLightFade <span class="token operator">=</span> <span class="token function">waitToFade</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 10%</span>
<span class="token keyword">const</span> secondLightProgress <span class="token operator">=</span> <span class="token function">secondLightFade</span><span class="token punctuation">(</span>firstLightProgress<span class="token punctuation">)</span>
</code></pre>
<h1 id="the-goods"><a href="#the-goods">The Goods</a></h1>
<h2 id="shortcuts"><a href="#shortcuts">Shortcuts</a></h2>
<p>Here are the finished shortcuts, ready to install. You&#x27;ll be prompted to set up the wakeup server <code>URL</code>, your <code>routineId</code>, and your wakeup duration (for the fade).</p>
<p>They should probably be installed in the order listed below, as later shortcuts depend on earlier ones.</p>
<!-- -->
<section class="styles_shortcutsGroup__O4FYg undefined"><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Run%20JavaScript.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #E5BB00, #FACC0C)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Run JavaScript<!-- --> â†—ï¸</p></div></a><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Get%20Alarm%20Details.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #00D1AC, #00D6B5)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Get Alarm Details<!-- --> â†—ï¸</p></div></a><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Find%20Next%20Alarm.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #F39227, #F49E44)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Find Next Alarm<!-- --> â†—ï¸</p></div></a><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Inform%20Server.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #8E817C, #9C908C)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Inform Server<!-- --> â†—ï¸</p></div></a><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Schedule%20Wakeup%20and%20Confirm.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #ED4249, #F0595D)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Schedule Wakeup and Confirm<!-- --> â†—ï¸</p></div></a><a href="https://github.com/reubn/wakeup/raw/main/shortcuts/Ask%20If%20Alarm%20Modified.shortcut"><div class="styles_shortcut__76XNI" style="background:radial-gradient(circle at top left, #00CAE0, #00D2E6)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 86 97" class="styles_icon__17i2r"><path d="M53.873 3.364 80.651 21.23c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313l-11.39 7.62 10.379 6.924c5.513 3.679 7 11.13 3.321 16.643a12 12 0 0 1-3.31 3.313L52.895 93.595a20 20 0 0 1-22.67-.295L5.07 75.51c-5.41-3.827-6.694-11.316-2.867-16.727a12 12 0 0 1 2.88-2.876l11.038-7.787-10.05-7.11C.66 37.183-.624 29.694 3.203 24.283a12 12 0 0 1 2.88-2.876l25.16-17.75a20 20 0 0 1 22.63-.293ZM10.272 63.26a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L61.171 54.22l-7.278 4.874a20 20 0 0 1-22.67-.295l-7.305-5.167-13.647 9.628Zm26.16-52.25-25.16 17.75a3 3 0 0 0-.003 4.901l25.152 17.79a11 11 0 0 0 12.468.163l26.77-17.908a3 3 0 0 0 .688-.638l.139-.19a3 3 0 0 0-.83-4.161L48.877 10.85a11 11 0 0 0-12.447.162Z"></path></svg><p>Ask If Alarm Modified<!-- --> â†—ï¸</p></div></a></section>
<h2 id="automations"><a href="#automations">Automations</a></h2>
<p>To get the shortcut to run itself each evening, you should create the following automations in Shortcuts. Unfortunately these can&#x27;t be imported.</p>
<pre><span><button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button></span><code>When Wind Down starts -&gt; Run Shortcut &#x27;Schedule Wakeup and Confirm&#x27;
When Bedtime starts   -&gt; Run Shortcut &#x27;Schedule Wakeup and Confirm&#x27;
</code></pre>
<p>What happens if you edit your alarm after &#x27;wind down&#x27;? Well, as long as you edit the alarm in the Clock app, then we can create another automation to run when the Clock app is closed, and schedule the alarm for the new time. Create the automation as follows:</p>
<pre><span><button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button></span><code>When &quot;Clock&quot; is closed -&gt; Run Shortcut &#x27;Ask If Alarm Modified&#x27;
</code></pre>
<p>You will have to swipe up, rather than locking your phone straight away, but it&#x27;s bearable.</p>
<p>For all of these automations you should disable <code>Ask Before Running</code> and <code>Notify When Run</code>.</p>
<!-- -->
<img width="828" height="259" src="/.assets/b7f7afc91b2566515e8e3d99b0de16d2/toggleOff.webp" srcSet="/.assets/b7f7afc91b2566515e8e3d99b0de16d2/toggleOff.webp 828w" sizes="min(1000px, 100vw - 1rem)" class="styles_image__OsWFw " style="max-width:50%" loading="lazy" alt="Turn off Ask Before Running and Notify When Run"/>
<p>If you know that you&#x27;ll always go to sleep before midnight say - and always be waking up after midnight, you could set an automation to set the alarm at midnight each day - doing this you loose the ability to correct mistakes, and in its present state, the shortcut would override any adjustments you&#x27;d made previously.</p>
<h2 id="server"><a href="#server">Server</a></h2>
<p>The server is available <a href="https://github.com/reubn/wakeup">here</a>, and can be deployed using <code>docker-compose</code>.
You&#x27;ll need to</p>
<ul>
<li>set the <code>HA_URL</code> and <code>HA_TOKEN</code> environment variables</li>
<li>run <code>npm run createRoutine $name</code> to create some routines</li>
<li>create corresponding scenes in the <code>scenes</code> folder to fade your lights</li>
</ul>
<h2 id="whats-next"><a href="#whats-next">What&#x27;s Next?</a></h2>
<p>This set up isn&#x27;t perfect. There are issues where iOS will display the wrong time to the user when there is a <code>DST</code> shift. The lights fade at the correct time however, so it&#x27;s not a huge issue. I haven&#x27;t investigated if this is another Shortcuts bug, or if it&#x27;s an issue with my logic.</p><!--/$--></div></article><script>window.__HACK_GLOBAL = {...(window.__HACK_GLOBAL || {}), ["shortcuts-wakeup-alarm"]: document.getElementById('HACK-POST-shortcuts-wakeup-alarm').innerHTML}</script></main><footer class="styles_footer___S6qT"><p class="styles_icons__QjG6W"><a href="//unsplash.com/@re" class="styles_unsplash__08X6l" title="Unsplash"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg></a><a href="//github.com/reubn" class="styles_github__wPJrT" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><a href="mailto:click.to.reveal@email.com" class="styles_mail__SVvds" title="Email"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><rect x="2" y="4" width="20" height="16" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg></a><a href="//twitter.com/reubn_" class="styles_twitter__SjH0n" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg></a><a rel="me" href="https://mastodon.social/@Reu" class="styles_mastodon__tDTuK" title="Mastodon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><circle cx="12" cy="12" r="4"></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path></svg></a><a href="//instagram.com/reubn" class="styles_instagram__xE7da" title="Instagram"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 132 132" width="0" height="0"><defs><linearGradient id="instagram" gradientTransform="rotate(45)"><stop offset="0" stop-color="#fd5"></stop><stop offset=".1" stop-color="#fd5"></stop><stop offset=".5" stop-color="#ff543e"></stop><stop offset="1" stop-color="#c837ab"></stop></linearGradient></defs></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg></a></p><a href="https://github.com/reubn/reuben.science/tree/main/content/posts/shortcuts-wakeup-alarm" class="styles_code__RcMRV" title="Source Code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="styles_icon__cHT3M"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></a></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"shortcuts-wakeup-alarm","metadata":{"title":"Wakeup Lights with Shortcuts","description":"Sunrise Lights using Shortcuts, and Home Assistant","emoji":"ðŸ’¡","date":"2023-08-07T00:00:00.000Z","category":["dev","automation"],"image":{"id":0.5119457178451781,"resolutions":{"1":{"src":"/.assets/afcc8d383d981938c46d0641e9035280/header.webp","scale":1,"width":1000,"height":400},"2":{"src":"/.assets/63c382a6dfa9a50deac4c1350c6c2698/header.webp","scale":2,"width":2000,"height":800},"3":{"src":"/.assets/82ac3a5f077f7c29198c3d9be1b27ac1/header.webp","scale":3,"width":3000,"height":1200},"0.5":{"src":"/.assets/9e46b0ed7a1cae2ac96070e91b37ed76/header.webp","scale":0.5,"width":500,"height":200}}},"readingTime":{"mins":8,"words":1592}},"hidden":false},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"shortcuts-wakeup-alarm"},"buildId":"0X5amzdhl_xuQnsesc_MO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>