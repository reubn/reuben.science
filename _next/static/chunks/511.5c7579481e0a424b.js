"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{3905:function(e,a,t){t.d(a,{kt:function(){return l}});var n=t(7294);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){s(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function r(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var p=n.createContext({}),i=function(e){var a=n.useContext(p),t=a;return e&&(t="function"===typeof e?e(a):c(c({},a),e)),t},m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},k=n.forwardRef((function(e,a){var t=e.components,s=e.mdxType,o=e.originalType,p=e.parentName,k=r(e,["components","mdxType","originalType","parentName"]),l=i(t),N=s,u=l["".concat(p,".").concat(N)]||l[N]||m[N]||o;return t?n.createElement(u,c(c({ref:a},k),{},{components:t})):n.createElement(u,c({ref:a},k))}));function l(e,a){var t=arguments,s=a&&a.mdxType;if("string"===typeof e||s){var o=t.length,c=new Array(o);c[0]=k;var r={};for(var p in a)hasOwnProperty.call(a,p)&&(r[p]=a[p]);r.originalType=e,r.mdxType="string"===typeof e?e:s,c[1]=r;for(var i=2;i<o;i++)c[i]=t[i];return n.createElement.apply(null,c)}return n.createElement.apply(null,t)}k.displayName="MDXCreateElement"},3511:function(e,a,t){t.r(a),t.d(a,{codeBlocks:function(){return o},metadata:function(){return c},default:function(){return p}});t(7294);var n=t(3905);function s(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var o=[{language:"js",lines:["import {patch} from './serviceWorkerPatch'","","const serviceWorker = patch(() =>","  navigator.serviceWorker.register(","    new URL(/* webpackChunkName: \"../../../public/_\" */ './serviceWorker.js', import.meta.url)","  )",")"]},{language:"js",lines:["export const patch = fn => {","  const originalToString = URL.prototype.toString","","  URL.prototype.toString = function(){","   return originalToString.call(this).replace('public/', '')","  }","","  const result = fn()","","  URL.prototype.toString = originalToString","","  return result","}"]}],c={title:"Import Service Workers in Next.js",description:"Emit Service Workers to the Root Directory",emoji:"\ud83d\udce6",date:"2021-08-05"},r={codeBlocks:o,metadata:c};function p(e){var a=e.components,t=s(e,["components"]);return(0,n.kt)("wrapper",Object.assign({},r,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"Webpack")," is very fussy when it comes to importing ",(0,n.kt)("inlineCode",{parentName:"p"},"Service Workers"),". The format of the ",(0,n.kt)("inlineCode",Object.assign({parentName:"p"},{className:"language-js"}),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token dom variable"}),"navigator"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token property-access"}),"serviceWorker"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token method function property-access"}),"register"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token keyword"}),"new")," ",(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token class-name"}),"URL"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token string"}),"'./serviceWorker.js'"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),",")," ",(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token keyword module"}),"import"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token property-access"}),"meta"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token property-access"}),"url"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),")"),(0,n.kt)("span",Object.assign({parentName:"inlineCode"},{className:"token punctuation"}),")"))," call is fixed."),(0,n.kt)("p",null,"This ",(0,n.kt)("strong",{parentName:"p"},"hack")," works around that, patching the ",(0,n.kt)("inlineCode",{parentName:"p"},"URL.toString()")," function so that the ",(0,n.kt)("inlineCode",{parentName:"p"},"URL")," points to the chunk, emitted to the ",(0,n.kt)("inlineCode",{parentName:"p"},"public")," folder - which is served at the server root, allowing full ",(0,n.kt)("inlineCode",{parentName:"p"},"Service Worker")," ",(0,n.kt)("inlineCode",{parentName:"p"},"scope"),".\nIn other words this emulates ",(0,n.kt)("inlineCode",{parentName:"p"},"publicPath")," inline."),(0,n.kt)("pre",null,(0,n.kt)("span",Object.assign({parentName:"pre"},{dangerouslySetInnerHTML:{__html:'<button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button>'}})),(0,n.kt)("code",Object.assign({parentName:"pre"},{className:"language-js",metastring:"// wherever.js"}),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword module"}),"import")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token imports"}),(0,n.kt)("span",Object.assign({parentName:"span"},{className:"token punctuation"}),"{"),"patch",(0,n.kt)("span",Object.assign({parentName:"span"},{className:"token punctuation"}),"}"))," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword module"}),"from")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token string"}),"'./serviceWorkerPatch'"),"\n\n",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"const")," serviceWorker ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token function"}),"patch"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token arrow operator"}),"=>"),"\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token dom variable"}),"navigator"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"serviceWorker"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token method function property-access"}),"register"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"new")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token class-name"}),"URL"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token comment"}),'/* webpackChunkName: "../../../public/_" */')," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token string"}),"'./serviceWorker.js'"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),",")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword module"}),"import"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"meta"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"url"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),"\n",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),"\n")),(0,n.kt)("pre",null,(0,n.kt)("span",Object.assign({parentName:"pre"},{dangerouslySetInnerHTML:{__html:'<button class="clickToCopy" onmousedown="COPY_FN(event)" onmouseup="CLEAR_FN(event)">Copy</button>'}})),(0,n.kt)("code",Object.assign({parentName:"pre"},{className:"language-js",metastring:"// serviceWorkerPatch.js"}),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword module"}),"export")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"const")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token function-variable function"}),"patch")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token parameter"}),"fn")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token arrow operator"}),"=>")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"const")," originalToString ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token class-name"}),"URL"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"prototype"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"toString"),"\n\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token class-name"}),"URL"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"prototype"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token method-variable function-variable method function property-access"}),"toString")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"function"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"{"),"\n   ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword control-flow"}),"return")," originalToString",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token method function property-access"}),"call"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"this"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token method function property-access"}),"replace"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token string"}),"'public/'"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),",")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token string"}),"''"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword"}),"const")," result ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token function"}),"fn"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"("),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),")"),"\n\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token class-name"}),"URL"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"prototype"),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"."),(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token property-access"}),"toString")," ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token operator"}),"=")," originalToString\n\n  ",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token keyword control-flow"}),"return")," result\n",(0,n.kt)("span",Object.assign({parentName:"code"},{className:"token punctuation"}),"}"),"\n")))}p.isMDXComponent=!0}}]);